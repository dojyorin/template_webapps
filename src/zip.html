<!doctype html>
<meta charset="utf-8">

<script src="https://cdn.jsdelivr.net/npm/jszip@latest/dist/jszip.min.js"></script>

<script async type="module">
    /**
    * @param {[string, Uint8Array][]} files
    * @return {Promise<Uint8Array>}
    */
    async function zipEncode(files){
        const ctx = new JSZip();

        for(const [k, v] of files){
            ctx.file(k, v, {
                binary: true
            });
        }

        return await ctx.generateAsync({
            type: "uint8array",
            compression: "deflate",
            compressionOptions: {
                level: 9
            }
        });
    }

    /**
    * @param {Uint8Array} archive
    * @return {Promise<[string, Uint8Array][]>}
    */
    async function zipDecode(archive){
        const ctx = new JSZip();

        const {files} = await ctx.loadAsync(archive, {
            checkCRC32: true
        });

        return await Promise.all(Object.values(files).filter(({dir}) => !dir).map(async f => ([f.name, await f.async("uint8array")])));
    }

    document.getElementById("files").onchange = async({target: {files}})=>{
        const encode = await zipEncode(await Promise.all([...files].map(async f => ([f.name, await f.arrayBuffer()]))));
        const decode = await zipDecode(encode);

        console.log(encode);
        console.log(decode);
    };
</script>

<main>
    <input multiple type="file" id="files">
</main>