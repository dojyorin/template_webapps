<!doctype html>
<meta charset="utf-8">

<script async type="module">
    import * as excel from "https://cdn.sheetjs.com/xlsx-latest/package/xlsx.mjs";
    import * as excelcp from "https://cdn.sheetjs.com/xlsx-latest/package/dist/cpexcel.full.mjs";

    excel.set_cptable(excelcp);

    /**
    * @param {ExcelWorkBook} book
    */
    function excelEncode(book){
        /** @type {ArrayBuffer} */
        const data = excel.write(book, {
            type: "array",
            codepage: 932,
            bookType: "xlsx",
            compression: true
        });

        return new Uint8Array(data);
    }

    /**
    * @param {Uint8Array} binary
    */
    function excelDecode(binary){
        /** @type {ExcelWorkBook} */
        const book = excel.read(binary.buffer, {
            type: "array",
            codepage: 932,
            raw: true
        });

        return book;
    }

    document.getElementById("excel").onchange = async({target: {files}})=>{
        const decode = excelDecode(new Uint8Array(await files[0].arrayBuffer()));
        const encode = excelEncode(decode);

        console.log(decode);
        console.log(encode);
    };
</script>

<main>
    <input type="file" accept=".xls,.xlsx" id="excel">
</main>