<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, height=device-height, minimum-scale=1, maximum-scale=1, initial-scale=1, user-scalable=no">
        <meta name="referrer" content="no-referrer">

        <title></title>
    </head>

    <body></body>

    <script async type="module">
        function toScriptURL(...functions){
            return URL.createObjectURL(new Blob([functions.map(f => f.toString().replace(/^.+?\{/s, "").replace(/\}$/s, "")).join(";")]));
        }

        const script = toScriptURL(()=>{
            globalThis.addEventListener("message", ({data})=>{
                const sample = data.map(n => n * 2);
                globalThis.postMessage(sample, [sample.buffer]);
            });
        });

        const worker = new Worker(script);

        worker.addEventListener("message", ({data})=>{
            console.log(data);
            worker.terminate();
        });

        const sample = new Uint8Array(new Float32Array(16 / 4 * 0x100000).map(() => Math.random()).buffer);
        worker.postMessage(sample, [sample.buffer]);
    </script>
</html>