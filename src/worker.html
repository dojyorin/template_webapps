<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, height=device-height, minimum-scale=1, maximum-scale=1, initial-scale=1, user-scalable=no">
        <meta name="referrer" content="no-referrer">

        <title>WebWorker</title>
    </head>

    <body>
        Web Worker API
    </body>

    <script async type="module">
        class WorkerInline extends Worker{
            constructor(...sources){
                super(URL.createObjectURL(new Blob([sources.map(s => s.toString().replace(/^.+?\{/s, "").replace(/\}$/s, "").replace(/^\s+/gm, "").trim()).join("\n;\n")])));
            }
        }

        const worker = new WorkerInline(()=>{
            globalThis.addEventListener("message", ({data})=>{
                const sample = data.map(n => n * 2);
                globalThis.postMessage(sample, [sample.buffer]);
            });
        });

        worker.addEventListener("message", ({data})=>{
            console.log(data);
        });

        const sample = new Uint8Array(new Float32Array(16 / 4 * 0x100000).map(() => Math.random()).buffer);
        worker.postMessage(sample, [sample.buffer]);
    </script>
</html>