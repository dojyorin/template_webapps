<!doctype html>
<meta charset="utf-8">

<script async type="module">
    /**
    * @template T
    * @param {string} key
    * @param {T} defaultValue
    * @param {Storage} storage
    * @return {{remove(): void; reset(): void; value: T;}}
    */
    function bindStorage(key, defaultValue, storage) {
        return {
            remove() {
                storage.removeItem(key);
            },
            reset() {
                storage.setItem(key, JSON.stringify(defaultValue));
            },
            /** @type {T} */
            get value() {
                const v = storage.getItem(key);

                if (v === null) {
                    storage.setItem(key, JSON.stringify(defaultValue));

                    return defaultValue;
                }

                return JSON.parse(v);
            },
            set value(v) {
                storage.setItem(key, JSON.stringify(v));
            }
        };
    }

    const aaa = bindStorage("aaa", "foo", sessionStorage);
    console.log(aaa.value);
    aaa.value = "bar";
    console.log(aaa.value);

    const bbb = bindStorage("bbb", 0, localStorage);
    console.log(bbb.value);
    bbb.value = 12345;
    console.log(bbb.value);

    sessionStorage.clear();
    localStorage.clear();
</script>