<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, height=device-height, minimum-scale=1, maximum-scale=1, initial-scale=1, user-scalable=no">
        <meta name="referrer" content="no-referrer">

        <title>ZLIB</title>
    </head>

    <body>
        Compression Streams API
    </body>

    <script async type="module">
        async function zlibCodec(data, deflate, encode){
            return new Uint8Array(await new Response(new Blob([data?.buffer ?? ""]).stream().pipeThrough(new(encode ? CompressionStream : DecompressionStream)(deflate ? "deflate" : "gzip"))).arrayBuffer());
        }

        const raw = new Uint8Array(new Float32Array(0x100000).map(() => Math.random()).buffer);

        const deflateE = await zlibCodec(raw, true, true);
        const deflateD = await zlibCodec(deflateE, true, false);

        const gzipE = await zlibCodec(raw, false, true);
        const gzipD = await zlibCodec(gzipE, false, false);

        console.log("---------- Raw Data ----------");
        console.log(raw);

        console.log("---------- Encoded Data ----------");
        console.log(deflateE);
        console.log(gzipE);

        console.log("---------- Decoded Data ----------");
        console.log(deflateD);
        console.log(gzipD);
    </script>
</html>