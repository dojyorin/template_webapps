<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, height=device-height, minimum-scale=1, maximum-scale=1, initial-scale=1, user-scalable=no">
        <meta name="referrer" content="no-referrer">

        <title>Fetch</title>
    </head>

    <body>
        Fetch API
    </body>

    <script async type="module">
        Object.defineProperty(globalThis, "$fetch", {
            enumerable: false,
            configurable: false,
            writable: false,
            async value(url, option){
                return (await fetch(Object.entries(option?.params ?? {}).reduce((u, [k, v])=>{
                    u.searchParams.append(k, v);
                    return u;
                }, new URL(url, /^http(s|):\/\//i.test(url) ? undefined : location.href)), {
                    headers: Object.entries(option?.headers ?? {}).reduce((h, [k, v])=>{
                        h.append(k, v);
                        return h;
                    }, new Headers()),
                    method: option?.method ?? "get",
                    credentials: option?.credentials ?? "omit",
                    body: option?.body ?? null,
                    mode: option?.mode ?? "cors",
                    cache: option?.cache ?? "no-cache",
                    referrerPolicy: option?.referrerPolicy ?? "no-referrer",
                    referrer: option?.referrer ?? "",
                    redirect: option?.redirect ?? "follow",
                    keepalive: option?.keepalive ?? false,
                    integrity: option?.integrity ?? "",
                    signal: option?.signal ?? null,
                    window: null
                }))[option?.type ?? "json"]();
            }
        });

        const result = await $fetch("http://worldclockapi.com/api/json/utc/now");
        console.log(result);
    </script>
</html>